using UnityEngine;
using System.Collections.Generic;

public class SummonGrandchild : SpecialWeaponBase
{
    [Header("Config")]
    [SerializeField] private GameObject grandchildPrefab;
    [SerializeField] private float damage;
    [SerializeField] private float speed;
    [SerializeField] private float range;
    [SerializeField] private int quantity;

    private bool active = false;
    private List<Grandchild> grandchildList = new List<Grandchild>();
    
    public override void ToggleActivate()
    {
        if (active)
        {
            Deactivate();
            active = false;
        }
        else
        {
            Activate();
            active = true;
        }
    }
    
    private void Activate()
    {
        for (int i = 0; i < quantity; i++)
        {
            GameObject grandchildGO = Instantiate(grandchildPrefab, PlayerController.Instance.transform);
            Grandchild grandchild = grandchildGO.GetComponent<Grandchild>();
            grandchild.Initialise(damage, speed, range);
            grandchildList.Add(grandchild);
        }
    }

    private void Deactivate()
    {
        foreach (var grandchild in grandchildList)
        {
            if (grandchild != null)
                Destroy(grandchild.gameObject);
        }
        grandchildList.Clear();
    }
}
